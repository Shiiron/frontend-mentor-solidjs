import{ssrElement as h,escape as d,mergeProps as q,ssr as c,renderToStream as A,getRequestEvent as M,createComponent as p,NoHydration as $,ssrHydrationKey as y,ssrAttribute as F}from"solid-js/web";import{lazy as H,createComponent as N,sharedConfig as b}from"solid-js";import{provideRequestEvent as I}from"solid-js/web/storage";import{getRequestURL as E,getRequestWebStream as k,getRequestIP as L,setResponseHeader as g,setResponseStatus as S,appendResponseHeader as P,getResponseHeader as O,removeResponseHeader as j,getCookie as _,setCookie as B,eventHandler as z,sendRedirect as J,setHeader as U}from"h3";import{p as W,m as D}from"./assets/routes-ae4005b9.js";function K(e){let t;return new Request(E(e),{duplex:"half",method:e.method,headers:e.headers,get body(){return t||(t=k(e),t)}})}const C=Symbol("h3Event"),m=Symbol("fetchEvent"),Y={get(e,t){return t===m?e:e[t]??e[C][t]}};function G(e){return e.web||(e.web={url:E(e),request:K(e)}),new Proxy({request:e.web.request,clientAddress:L(e),locals:{},[C]:e},Y)}function Q(e){if(!e[m]){const t=G(e);e[m]=t}return e[m]}var V=" ";const X={style:e=>h("style",e.attrs,()=>d(e.children),!0),link:e=>h("link",e.attrs,void 0,!0),script:e=>e.attrs.src?h("script",q(()=>e.attrs,{get id(){return e.key}}),()=>c(V),!0):null};function T(e){let{tag:t,attrs:{key:n,...s}={key:void 0},children:o}=e;return X[t]({attrs:s,key:n,children:o})}function Z(e,t,n,s="default"){return H(async()=>{{const r=(await e.import())[s],f=(await t.inputs?.[e.src].assets()).filter(i=>i.tag==="style"||i.attrs.rel==="stylesheet");return{default:i=>[...f.map(l=>T(l)),N(r,i)]}}})}function x(){function e(n){return{...n,...n.$$route?n.$$route.require().route:void 0,metadata:{...n.$$route?n.$$route.require().route.metadata:{},filesystem:!0},component:Z(n.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:n.children?n.children.map(e):void 0}}return W.map(e)}function ee(e){const t=_(e,"flash");if(!t)return;let n=JSON.parse(t);if(!n||!n.result)return[];const s=[...n.input.slice(0,-1),new Map(n.input[n.input.length-1])];return B(e,"flash","",{maxAge:0}),{url:n.url,result:n.error?new Error(n.result):n.result,input:s}}async function te(e){const t=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,g(e,"Content-Type","text/html"),Object.assign(e,{manifest:await t.json(),assets:[...await t.inputs[t.handler].assets()],initialSubmission:ee(e),routes:x(),components:{status:s=>(S(e,s.code,s.text),()=>S(e,200)),header:s=>(s.append?P(e,s.name,s.value):g(e,s.name,s.value),()=>{const o=O(e,s.name);if(o&&typeof o=="string"){const r=o.split(", "),a=r.indexOf(s.value);a!==-1&&r.splice(a,1),r.length?g(e,s.name,r.join(", ")):j(e,s.name)}})},$islands:new Set})}function ne(e,t={}){return z({onRequest:t.onRequest,onBeforeResponse:t.onBeforeResponse,handler:n=>{const s=Q(n);return I(s,async()=>{const o=D(new URL(s.request.url).pathname,s.request.method);if(o){const u=(await o.handler.import())[s.request.method];return s.params=o.params,b.context={event:s},await u(s)}const r=await te(s);let a={...t};if(a.onCompleteAll){const l=a.onCompleteAll;a.onCompleteAll=u=>{v(r)(u),l(u)}}else a.onCompleteAll=v(r);if(a.onCompleteShell){const l=a.onCompleteShell;a.onCompleteShell=u=>{R(r,n)(),l(u)}}else a.onCompleteShell=R(r,n);const f=A(()=>(b.context.event=r,e(r)),a);if(r.response&&r.response.headers.get("Location"))return J(s,r.response.headers.get("Location"));const{writable:w,readable:i}=new TransformStream;return f.pipeTo(w),i})}})}function R(e,t){return()=>{e.response&&e.response.headers.get("Location")&&(S(t,302),U(t,"Location",e.response.headers.get("Location")))}}function v(e){return({write:t})=>{const n=e.response&&e.response.headers.get("Location");n&&t(`<script>window.location="${n}"<\/script>`)}}function se(e,t){return ne(e,{...t,createPageEvent:re})}async function re(e){const t=globalThis.MANIFEST.client;return Object.assign(e,{manifest:await t.json(),assets:[...await t.inputs[t.handler].assets()],routes:[],$islands:new Set})}var ae=["<script",">","<\/script>"],oe=["<script",' type="module"',"><\/script>"];const ie=c("<!DOCTYPE html>");function le(e){const t=M();return p($,{get children(){return[ie,p(e.document,{get assets(){return t.assets.map(n=>T(n))},get scripts(){return[c(ae,y(),`window.manifest = ${JSON.stringify(t.manifest)}`),c(oe,y(),F("src",d(globalThis.MANIFEST.client.inputs[globalThis.MANIFEST.client.handler].output.path,!0),!1))]}})]}})}var ue=['<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico">',"</head>"],ce=["<html",' lang="en">','<body><div id="app">',"</div><!--$-->","<!--/--></body></html>"];const ge=se(()=>p(le,{document:({assets:e,children:t,scripts:n})=>c(ce,y(),p($,{get children(){return c(ue,d(e))}}),d(t),d(n))}));export{ge as default};
